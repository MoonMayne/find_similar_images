<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Similar Images</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body class="bg-black text-[#e8dcf5]">

    <div class="container mx-auto px-8 pt-8 pb-2">
        <header class="text-center">
            <h1 class="text-3xl font-bold text-[#e8dcf5]">Find Similar Images</h1>
            <p class="text-[#a695c7]">Scan directories to find and manage duplicate images.</p>
        </header>

        <!-- Scan Setup Screen -->
        <main id="screen-scan-setup">
            <div class="gradient-card p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-semibold mb-6 text-[#e8dcf5]">Scan Setup</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    
                    <!-- Left Column: Directories -->
                    <div>
                        <div class="flex items-center mb-2">
                            <label for="dirInput" class="block text-sm font-medium text-[#c9b8e3]">Image Directories</label>
                            <div class="group relative ml-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#a695c7]" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                </svg>
                                <div class="absolute bottom-full z-10 mb-2 hidden w-64 rounded-md bg-[#251747] p-2 text-xs text-[#e8dcf5] group-hover:block border border-[#552d70]">
                                    Add one or more directories to scan for similar images. The app will search these folders recursively.
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 mb-4">
                            <input type="text" id="dirInput" placeholder="/path/to/your/images" class="flex-grow bg-[#251747] text-[#e8dcf5] border border-[#552d70] rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#9c539c] focus:border-[#9c539c] placeholder-[#7c6ba0]">
                            <button id="btnAddDir" class="gradient-button-primary primary-glow-hover text-[#e8dcf5] font-bold py-2 px-4 rounded-md transition duration-300">Add</button>
                        </div>
                        <div id="dirList" class="bg-[#1a0f2e] border border-[#552d70] rounded-md p-3 min-h-[150px] max-h-64 overflow-y-auto">
                            <!-- Directory items will be injected here -->
                        </div>
                        <button id="btnRemoveDir" class="mt-3 gradient-button-destructive destructive-glow-hover text-[#e8dcf5] py-2 px-4 rounded-md transition duration-300">Remove Selected</button>
                    </div>

                    <!-- Middle Column: Required Options -->
                    <div>
                        <div class="space-y-6">
                            <div>
                                <div class="flex items-center">
                                    <label for="primaryDir" class="block text-sm font-medium text-[#c9b8e3]">Primary Directory</label>
                                    <div class="group relative ml-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#a695c7]" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                        </svg>
                                        <div class="absolute bottom-full z-10 mb-2 hidden w-64 rounded-md bg-[#251747] p-2 text-xs text-[#e8dcf5] group-hover:block border border-[#552d70]">
                                            If set, images in this directory will be suggested as the 'keeper' by default.
                                        </div>
                                    </div>
                                </div>
                                <p class="text-xs text-[#7c6ba0] mb-2">Files in this directory will be preferred as keepers.</p>
                                <select id="primaryDir" class="mt-1 block w-full bg-[#251747] text-[#e8dcf5] border border-[#552d70] rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#9c539c] focus:border-[#9c539c]">
                                    <option value="">(Select from added directories)</option>
                                </select>
                            </div>

                            <div>
                                <div class="flex items-center">
                                    <label for="algorithm" class="block text-sm font-medium text-[#c9b8e3]">Algorithm</label>
                                    <div class="group relative ml-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#a695c7]" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                        </svg>
                                        <div class="absolute bottom-full z-10 mb-2 hidden w-72 rounded-md bg-[#251747] p-2 text-xs text-[#e8dcf5] group-hover:block border border-[#552d70]">
                                            The algorithm for detecting similar images. <strong>Perceptual Hash (phash)</strong> is recommended for beginners as it's great for finding visually similar images even if they are different sizes or have minor edits. Other hashes might be faster but less accurate.
                                        </div>
                                    </div>
                                </div>
                                <select id="algorithm" class="mt-1 block w-full bg-[#251747] text-[#e8dcf5] border border-[#552d70] rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#9c539c] focus:border-[#9c539c]">
                                    <option value="phash" selected>Perceptual Hash (phash)</option>
                                    <option value="ahash">Average Hash (ahash)</option>
                                    <option value="dhash">Difference Hash (dhash)</option>
                                    <option value="dhash_vertical">Vertical Difference Hash</option>
                                    <option value="phash_simple">Simple Perceptual Hash</option>
                                    <option value="whash">Wavelet Hash (whash)</option>
                                    <option value="colorhash">Color Hash</option>
                                    <option value="crop_resistant">Crop Resistant Hash</option>
                                </select>
                            </div>

                            <div>
                                <div class="flex items-center">
                                    <label for="hashSize" class="block text-sm font-medium text-[#c9b8e3]">Hash Size</label>
                                    <div class="group relative ml-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#a695c7]" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                        </svg>
                                        <div class="absolute bottom-full z-10 mb-2 hidden w-64 rounded-md bg-[#251747] p-2 text-xs text-[#e8dcf5] group-hover:block border border-[#552d70]">
                                            Controls the sensitivity of the algorithm. Higher values are stricter and will find more subtle differences. The default of 8 is a good starting point.
                                        </div>
                                    </div>
                                </div>
                                <p class="text-xs text-[#7c6ba0] mb-2">Higher values are stricter. For whash, must be power of 2.</p>
                                <input type="number" id="hashSize" value="8" min="2" max="64" class="mt-1 block w-full bg-[#251747] text-[#e8dcf5] border border-[#552d70] rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#9c539c] focus:border-[#9c539c]">
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Advanced Settings -->
                    <div>
                        <h3 class="text-lg font-medium text-[#c9b8e3] mb-4">Advanced Settings</h3>
                        <div id="advancedOptions" class="space-y-6">
                            <div>
                                <div class="flex items-center">
                                    <label for="workers" class="block text-sm font-medium text-[#c9b8e3]">Number of Workers</label>
                                    <div class="group relative ml-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#a695c7]" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                        </svg>
                                        <div class="absolute bottom-full z-10 mb-2 hidden w-64 rounded-md bg-[#251747] p-2 text-xs text-[#e8dcf5] group-hover:block border border-[#552d70]">
                                            Number of parallel threads for hashing. Leave empty to use all available CPU cores, which is best for most users.
                                        </div>
                                    </div>
                                </div>
                                <p class="text-xs text-[#7c6ba0] mb-2">Defaults to CPU count if empty.</p>
                                <input type="number" id="workers" min="1" class="mt-1 block w-full bg-[#251747] text-[#e8dcf5] border border-[#552d70] rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#9c539c] focus:border-[#9c539c]">
                            </div>
                            <div>
                                <div class="flex items-center">
                                    <label for="trashDir" class="block text-sm font-medium text-[#c9b8e3]">Custom Trash Directory</label>
                                    <div class="group relative ml-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#a695c7]" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                        </svg>
                                        <div class="absolute bottom-full z-10 mb-2 hidden w-64 rounded-md bg-[#251747] p-2 text-xs text-[#e8dcf5] group-hover:block border border-[#552d70]">
                                            Specify a custom directory where deleted images will be moved. If left empty, they will go to the system's default trash.
                                        </div>
                                    </div>
                                </div>
                                <p class="text-xs text-[#7c6ba0] mb-2">Specify a custom directory to move deleted files to.</p>
                                <input type="text" id="trashDir" placeholder="/path/to/custom/trash" class="mt-1 block w-full bg-[#251747] text-[#e8dcf5] border border-[#552d70] rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-[#9c539c] focus:border-[#9c539c] placeholder-[#7c6ba0]">
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="enableSharpnessCheck" class="h-4 w-4 text-[#9c539c] focus:ring-[#9c539c] border-[#552d70] rounded">
                                <div class="flex items-center ml-2">
                                <label for="enableSharpnessCheck" class="block text-sm text-[#c9b8e3]">Enable sharpness check</label>
                                    <div class="group relative ml-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#a695c7]" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                        </svg>
                                        <div class="absolute bottom-full z-10 mb-2 hidden w-72 rounded-md bg-[#251747] p-2 text-xs text-[#e8dcf5] group-hover:block border border-[#552d70]">
                                            When enabled, the app will analyze image sharpness (focus) and suggest keeping the sharpest image in a group of duplicates. This is useful for photographers.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

                <!-- Action Bar -->
                <div class="mt-8 border-t border-[#552d70] pt-6 flex items-center justify-between">
                    <div>
                        <button id="btnStartScan" class="gradient-button-primary primary-glow-hover text-[#e8dcf5] font-bold py-2 px-6 rounded-md transition duration-300">Start Scan</button>
                        <button id="btnGoReview" class="ml-4 bg-[#251747] hover:bg-[#1a0f2e] text-[#e8dcf5] font-bold py-2 px-6 rounded-md transition duration-300 border border-[#552d70]" disabled>Go to Review</button>
                    </div>
                    <div id="scanStatus" class="text-sm text-[#a695c7]"></div>
                </div>
                <div id="validationErrorAlert" class="hidden mt-4 p-4 bg-[#401f54] border-l-4 border-[#ef4444] text-[#e8dcf5] rounded-md shadow-lg">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                        </svg>
                        <div class="flex-grow">
                            <h4 class="font-semibold text-lg">Directory Validation Failed</h4>
                            <p id="validationErrorMessage" class="mt-1 text-sm text-[#c9b8e3]"></p>
                        </div>
                        <button id="dismissValidationError" class="ml-4 text-[#c967a2] hover:text-[#d876a9]">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                        </button>
                    </div>
                </div>
                 <div class="w-full bg-[#1a0f2e] rounded-full h-2.5 mt-4 border border-[#552d70]" id="scanProgress" style="display:none;">
                    <div id="scanProgressFill" class="bg-gradient-to-r from-[#804595] to-[#c967a2] h-2.5 rounded-full relative flex items-center justify-center">
                        <span id="scanProgressText" class="text-xs font-semibold text-[#e8dcf5] absolute"></span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Review Screen (hidden by default) -->
        <section id="screen-review" style="display: none;" class="gradient-card pt-4 px-6 pb-6 rounded-lg shadow-lg">
            <h2 class="text-xl font-semibold text-[#e8dcf5] flex items-center justify-between mb-4">
                <button id="btnBackToScanSetup" class="bg-[#251747] hover:bg-[#1a0f2e] text-[#e8dcf5] font-bold py-2 px-4 rounded-md transition duration-300 text-sm border border-[#552d70]">← Back to Scan Setup</button>
                <div class="flex items-center space-x-4">
                    <span>Review Duplicates</span>
                    <button id="btnShortcuts" class="text-sm text-[#d876a9] hover:underline">[Shortcuts]</button>
                </div>
                <label class="inline-flex items-center cursor-pointer">
                    <input type="checkbox" value="" id="sideBySideToggle" class="sr-only peer">
                    <div class="relative w-11 h-6 bg-[#1a0f2e] peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[#9c539c] rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-[#e8dcf5] after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-[#e8dcf5] after:border-[#552d70] after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#9c539c]"></div>
                    <span class="ms-3 text-sm font-medium text-[#e8dcf5]">Side-by-Side</span>
                </label>
            </h2>
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- Left Column: Group List -->
                <div class="lg:col-span-1">
                    <div class="mb-4 space-y-2">
                        <div class="flex items-center space-x-2">
                            <label for="groupFilter" class="text-sm font-medium text-[#c9b8e3]">Filter:</label>
                            <select id="groupFilter" class="flex-grow bg-[#251747] text-[#e8dcf5] border border-[#552d70] rounded-md shadow-sm py-1 px-2 focus:outline-none focus:ring-[#9c539c] focus:border-[#9c539c]">
                                <option value="all">All</option>
                                <option value="reviewed">Reviewed</option>
                                <option value="unreviewed">Unreviewed</option>
                                <option value="kept">All Kept</option>
                                <option value="deleted">All Deleted</option>
                                <option value="mixed">Mixed</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <label for="groupSort" class="text-sm font-medium text-[#c9b8e3]">Sort By:</label>
                            <select id="groupSort" class="flex-grow bg-[#251747] text-[#e8dcf5] border border-[#552d70] rounded-md shadow-sm py-1 px-2 focus:outline-none focus:ring-[#9c539c] focus:border-[#9c539c]">
                                <option value="id">Group ID</option>
                                <option value="image_count">Image Count</option>
                                <option value="decision_status">Decision Status</option>
                            </select>
                            <button id="groupSortDirection" class="bg-[#251747] hover:bg-[#1a0f2e] text-[#e8dcf5] font-bold py-1 px-2 rounded-md transition duration-300 border border-[#552d70]">
                                <!-- Up/Down arrow icon -->
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"></path></svg>
                            </button>
                        </div>
                    </div>
                    <div class="bg-[#1a0f2e] border border-[#552d70] rounded-md p-3 max-h-[70vh] overflow-y-auto" id="groupList">
                        <!-- Group items will be injected here -->
                    </div>
                </div>

                <!-- Right Column: Image Preview and Actions -->
                <div class="lg:col-span-3">
                    <div class="bg-[#1a0f2e] rounded-lg shadow-inner p-4 h-[70vh] flex flex-col border border-[#552d70]">
                        <div class="relative mb-4 flex-grow" id="heroImageContainer">
                            <!-- Image(s) and associated text/badges will be dynamically injected here by JavaScript -->

                        </div>
                        <div id="thumbRow" class="flex items-center space-x-4 overflow-x-auto pb-2 flex-shrink-0">
                            <!-- Thumbnails will be injected here -->
                        </div>
                    </div>
                     <div class="mt-4 border-t border-[#552d70] pt-2 flex items-center justify-between">
                        <div class="flex space-x-2">
                            <button id="actToggleKeep" class="gradient-button-secondary accent-glow-hover text-[#e8dcf5] font-bold py-1 px-3 rounded-md transition duration-300 text-sm">Toggle Keep (K)</button>
                            <button id="actKeepAll" class="gradient-button-primary primary-glow-hover text-[#e8dcf5] font-bold py-1 px-3 rounded-md transition duration-300 text-sm">Keep All</button>
                            <button id="actDeleteAll" class="gradient-button-destructive destructive-glow-hover text-[#e8dcf5] font-bold py-1 px-3 rounded-md transition duration-300 text-sm">Delete All (D)</button>
                            <button id="actTrashNonSuggested" class="gradient-button-destructive destructive-glow-hover text-[#e8dcf5] font-bold py-1 px-3 rounded-md transition duration-300 text-sm">Trash Others (O)</button>
                        </div>
                        <div class="flex items-center">
                            <span id="pendingText" class="text-sm text-[#a695c7] mr-4"></span>
                            <button id="btnPrevGroup" class="bg-[#251747] hover:bg-[#1a0f2e] text-[#e8dcf5] font-bold py-1 px-3 rounded-md transition duration-300 mr-2 text-sm border border-[#552d70]">Previous (↑)</button>
                            <button id="btnNextGroup" class="bg-[#251747] hover:bg-[#1a0f2e] text-[#e8dcf5] font-bold py-1 px-3 rounded-md transition duration-300 mr-4 text-sm border border-[#552d70]">Next (↓)</button>
                            <button id="btnFinalize" class="gradient-button-primary primary-glow-hover text-[#e8dcf5] font-bold py-1 px-4 rounded-md transition duration-300">Finalize</button>
                        </div>
                    </div>
                </div>
            </div>
             <!-- Finalize Modal -->
            <div id="finalizeModal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center" style="display: none;">
                <div class="gradient-card border border-[#552d70] p-8 rounded-lg shadow-2xl w-full max-w-md">
                    <h3 class="text-2xl font-bold text-[#e8dcf5] mb-4">Finalize Actions</h3>
                    <p id="finalizeMessage" class="text-[#c9b8e3] mb-6"></p>
                    <p id="unreviewedWarning" class="text-yellow-400 mb-4" style="display: none;">You have unreviewed groups. How would you like to proceed?</p>
                    <div class="flex flex-col space-y-4">
                        <button id="optContinueReview" class="gradient-button-secondary accent-glow-hover text-[#e8dcf5] font-bold py-2 px-4 rounded-md transition duration-300">Continue Reviewing</button>
                        <button id="optKeepSuggested" class="gradient-button-primary primary-glow-hover text-[#e8dcf5] font-bold py-2 px-4 rounded-md transition duration-300">Keep All Suggested (Delete Others)</button>
                        <button id="optKeepPrimary" class="gradient-button-primary primary-glow-hover text-[#e8dcf5] font-bold py-2 px-4 rounded-md transition duration-300">Keep All in Primary Directory (Delete Others)</button>
                        <button id="optApplyTrash" class="gradient-button-destructive destructive-glow-hover text-[#e8dcf5] font-bold py-2 px-4 rounded-md transition duration-300">Apply Decisions & Trash</button>
                    </div>
                    <button id="btnCancelFinalize" class="mt-6 w-full bg-[#251747] hover:bg-[#1a0f2e] text-[#e8dcf5] border border-[#552d70] font-bold py-2 px-4 rounded-md">Cancel</button>
                </div>
            </div>

            <!-- Image Preview Modal -->
            <div id="imagePreviewModal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50" style="display: none;">
                <div class="gradient-card border border-[#552d70] p-4 rounded-lg shadow-2xl relative max-w-4xl max-h-[90vh]">
                    <button id="imagePreviewClose" class="absolute top-2 right-2 gradient-button-destructive destructive-glow-hover text-[#e8dcf5] font-bold py-1 px-3 rounded-full text-sm">X</button>
                    <img id="imagePreviewSrc" src="" alt="Image Preview" class="max-w-full max-h-[80vh] object-contain mx-auto">
                </div>
            </div>
            
            <!-- Keyboard Shortcuts Modal -->
            <div id="shortcutsModal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50" style="display: none;">
                <div class="gradient-card border border-[#552d70] p-8 rounded-lg shadow-2xl w-full max-w-lg">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-[#e8dcf5]">Keyboard Shortcuts</h3>
                        <button id="btnShortcutsClose" class="text-[#a695c7] hover:text-[#e8dcf5]">&times;</button>
                    </div>
                    <div class="space-y-4 text-[#c9b8e3]">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="font-mono bg-[#251747] border border-[#552d70] px-2 py-1 rounded">K</div>
                            <div>Toggle 'Keep' / 'Delete' for the selected image.</div>

                            <div class="font-mono bg-[#251747] border border-[#552d70] px-2 py-1 rounded">D</div>
                            <div>Mark all images in the current group for deletion.</div>

                            <div class="font-mono bg-[#251747] border border-[#552d70] px-2 py-1 rounded">O</div>
                            <div>Keep the 'Suggested' image and mark all others for deletion.</div>

                            <div class="font-mono bg-[#251747] border border-[#552d70] px-2 py-1 rounded">P</div>
                            <div>Keep only the currently selected image and mark others for deletion.</div>

                            <div class="font-mono bg-[#251747] border border-[#552d70] px-2 py-1 rounded">↑ / ↓</div>
                            <div>Navigate to the previous or next group.</div>

                            <div class="font-mono bg-[#251747] border border-[#552d70] px-2 py-1 rounded">← / →</div>
                            <div>Select the previous or next image in the thumbnail row.</div>

                            <div class="font-mono bg-[#251747] border border-[#552d70] px-2 py-1 rounded">Z (Hold)</div>
                            <div>Magnify the currently selected image.</div>
                        </div>
                    </div>
                </div>
            </div>

        </section>

    </div>

    <!-- Original Image Viewer Modal (for Magnify Mode) -->
    <div id="originalImageViewerModal" class="fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50" style="display: none;">
                <img id="originalImageSrc" src="" alt="Magnified Image" class="max-w-full max-h-full object-contain">
        <div id="magnifiedImageIndexDisplay" class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-[#251747] text-[#e8dcf5] border border-[#552d70] text-lg px-4 py-2 rounded-full z-50"></div>

    </div>

    <script src="/static/script.js"></script>
</body>
</html>